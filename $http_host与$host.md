# ```$http_host``` 与 ```$host```

在 Nginx 配置中，```$http_host``` 和 ```$host``` 都是用于获取请求中的主机信息的变量，但二者存在明显区别，主要体现在取值逻辑和适用场景上：

## ```$host``` 的取值逻辑

```$host``` 是 Nginx 内置变量，取值优先级如下（从高到低）：

- 优先取请求头中 Host 字段的值（若存在且有效）；
- 若请求头中没有 Host 字段，则取当前 server 块配置的 server_name 第一个值；
- 若未配置 server_name，则取服务器的 IP 地址。

特点：

- 会自动去除 Host 头中的端口号（例如请求头 ```Host: example.com:8080```，```$host``` 取值为 ```example.com```）；
- 始终有值（即使请求头中没有 Host 字段）。

## ```$http_host``` 的取值逻辑

```$http_host``` 是 Nginx 中用于获取请求头中 Host 字段原始值的变量，取值规则：

- 直接读取客户端发送的 Host 请求头内容，包含端口号（例如请求头 ```Host: example.com:8080```，```$http_host``` 取值为 ```example.com:8080）```；
- 若请求头中没有 Host 字段，则 ```$http_host``` 为空（无值）。

特点：

- 完全保留 Host 头的原始内容（包括端口）；
- 可能为空（当客户端未发送 Host 头时）。

## 主要区别对比
|维度|```$host```|```$http_host```|
|--|--|--|
|端口处理|自动去除端口号|保留原始端口号（若有）|
|空值情况|始终有值（Host 头 或 server_name 或 服务器IP）|可能为空（客户端未发送 Host 头时）|
|取值来源|优先 Host 头，次之为 server_name 配置，最后为服务器IP|仅来自客户端发送的 Host 头|

## 适用场景
- 使用 ```$host``` 的场景：
   当需要统一主机名（忽略端口），或确保变量始终有值时（例如反向代理的 ```proxy_set_header Host $host;```），避免因客户端未发送 Host 头导致的空值问题。
- 使用 ```$http_host``` 的场景：
   当需要保留原始请求的端口信息（例如代理需要传递完整的 ```Host:port``` 时），或明确依赖客户端发送的 Host 头原始内容时。
